<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="../css/base.css">
  <link rel="stylesheet" type="text/css" href="../css/weui.min.css">
  <link rel="stylesheet" type="text/css" href="../css/jquery-weui.min.css">
  <link rel="stylesheet" type="text/css" href="../css/main.css">
  <title>大健康</title>
  <style type="text/css">
    body {
      margin-bottom: 53px;
    }
    /*tabbar*/
    .tab-icon {
      background: url(../img/tabicon.png) 0px 0px no-repeat;
      background-size: cover;
    }
    .tab-icon1 {
      background-position: -27px 0;
    }
    .tab-icon2 {
      background-position: -54px 0;
    }
    .tab-icon3 {
      background-position: -81px 0;
    }
    .tab-active .weui-tabbar__label {
      color: #3da2d5;
    }
    .tab-active .tab-icon {
      background-position: -108px 0;
    }
    /*header*/
    #row {
      position: absolute;
      left: calc(50% - 103px);
      top: 87%;
      width: 206px;
      height: 30px;
      transition: transform .8s;
    }
    .my-header {
      position: relative;
      height: 237px;
      overflow: hidden;
      background: linear-gradient(#4dc3f4, #2face2, #0c93cd);
    }
    .weight-info {
      padding-top: 87px;
      text-align: center;
    }
    .weight-type {
      font-weight: 300;
      font-size: 0.74rem;
    }
    .weight-info p:last-child {
      font-size: 1.3rem;
    }
    @media only screen and (min-width: 480px) {
      .weight-info p:last-child {
        font-size: 1.2rem;
      }
    }
    .arc {
      position: relative;
      height: 157px;
      background: url('../img/gauge.png') no-repeat;
      background-position: 50% 92%;
      background-size: 220px 110px;
    }
    .person-height p:first-child, .person-bmi p:first-child,
    .person-oldWeight p:first-child, .person-score p:first-child {
      font-size: 0.72rem;
      font-weight: 200;
    }
    #height, #bmi, .oldWeight, #score {
      font-size: 1.1rem;
    }
    .person-height, .person-bmi, 
    .person-oldWeight, .person-score {
      display: flex;
      align-items: center;
      flex-direction: column;
      justify-content: center;
    }
    .person-bmi p:first-child {
      position: relative;
    }
    .person-bmi img {
      position: absolute;
      width: 20px;
      top: 3px;
      right: -26px;
    }

    /*swiper-pagination*/
    .pagination {
      position: absolute;
      left: 0;
      text-align: center;
      bottom: 6px;
      width: 100%;
    }
    .swiper-pagination-switch {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 8px;
      background: rgba(255,255,255, 0);
      border: 1px solid #fff;
      margin: 0 3px;
      cursor: pointer;
    }
    .swiper-active-switch {
      background: #fff;
    }
    /*history-weight*/
    .history-weight {
      position: relative;
      height: 218px;
      margin: 16px 0 16px;
      background: #fff;
    }
    /*more-row*/
    .more-row {
      position: absolute;
      height: 16px;
      top: 14px;
      right: 0;
      left: 0;
      background: rgba(255,255,255,0);
    }
    .more-row span {
      position: absolute;
      width: 16px;
      height: 16px;
      top: 0;
      right: 6%;
      background: url('../img/more-row.png') no-repeat;
      background-size: cover;
    }
    /*heath-analyse*/
    .heath-analyse {
      position: relative;
      overflow: hidden;
      height: 4.85rem;
      margin-bottom: 16px;
      background: #fff;
    }
    .heath-analyse .weui-flex__item {
      font-size: 0.75rem;
      color: #222;
    }
    .heath-analyse .weui-flex__item p:first-child {
      color: #666;
    }
    .heath-analyse .weui-flex {
      padding: 10px;
    }
    .heath-analyse .weui-flex__item:nth-child(2) {
      border-left: 1px solid #dcdcdc;
      border-right: 1px solid #dcdcdc;
    }
    /*special-column*/
    .special-column {
      height: 11.4rem;
      background: #fff;
      padding: 0 0.4rem 0.4rem;
    }
    .special-column .my-flex {
      display: flex;
      justify-content: space-around;
      margin: 7px 0 9px;
    }
    .special-column .my-flex .my-flex__item {
      width: 8.6rem;
      height: 4.4rem;
      cursor: pointer;
      color: #fff;
    }
    .special-column .my-flex__item p:first-child {
      margin-top: 23px;
      font-size: 16px;
    }
    .special-column .my-flex__item p:last-child {
      font-size: 0.6rem;
    }
    .special-sports {
      margin-right: 8px;
      background: url(../img/sport-plan.jpg);
      background-size: cover;
    }
    .special-diet {
      background: url(../img/diet-recommend.jpg);
      background-size: cover;
    }
    .special-health {
      margin-right: 8px;
      background: url(../img/health-knowledge.jpg);
      background-size: cover;
    }
    .special-expert {
      background: url(../img/expert-advice.jpg);
      background-size: cover;
    }
    footer {
      height: 70px;
      margin-top: 16px;
      color: #a1a1a1;
      font-size: 0.6rem;
      text-align: center;
    }
    footer p {
      padding: 0.2rem;
    }
  </style>
</head>
<body>
  <!-- header -->
  <header class="my-header">
    <div class="arc">
      <img src="../img/row.png" id="row" class="">
      <div class="weight-info color-fff">
        <p id="weightType" class="weight-type">--</p>
        <p><span id="weight" class="weight">--</span><span>斤</span></p>
      </div>
    </div>
    <div class="swiper-container">
        <div class="swiper-wrapper" style="height: 80px;">
            <div class="weui-flex swiper-slide">
              <div class="weui-flex__item person-height color-fff  text-center">
                <p>身高(cm)</p>
                <p id="height">--</p>
              </div>
              <div class="weui-flex__item person-bmi color-fff text-center">
                <p>BMI<img src="../img/help.png"></p>
                <p id="bmi">--</p>
              </div>
            </div>
            <div class="weui-flex swiper-slide">
              <div class="weui-flex__item person-oldWeight color-fff  text-center">
                <p>上次体重</p>
                <p class="oldWeight"><span id="lastWeight">--</span><span>斤</span></p>
              </div>
              <div class="weui-flex__item person-score color-fff text-center">
                <p>得分</p>
                <p id="score">--</p>
              </div>
            </div>
        </div>
        <!-- 如果需要分页器 -->
        <div class="pagination"></div>
    </div>
  </header>

  <!-- history-weight -->
  <section class="history-weight">
    <div id="historyWeight" style="height: 218px"></div>
    <a href="./history.html" class="more-row">
      <span></span>
    </a>
  </section>

  <!-- heath-analyse -->
  <section class="heath-analyse">
    <h3 class="head-title">健康分析</h3>
    <div class="weui-flex">
      <div class="weui-flex__item text-center">
        <p>标准BMI</p>
        <p id="standarBmi">--</p>
      </div>
      <div class="weui-flex__item text-center">
        <p>标准体重</p>
        <p id="standardWeight">--</p>
      </div>
      <div class="weui-flex__item text-center">
        <p>完美体重</p>
        <p id="perfectWeight">--</p>
      </div>
    </div>
    <a href="./analyse.html" class="more-row">
      <span></span>
    </a>
  </section>

  <!-- special-column -->
  <section class="special-column">
    <h3 class="head-title">专栏</h3>
    <div class="my-flex">
      <div class="my-flex__item text-center special-sports">
        <p>运动计划</p>
        <p>Sports plan</p>
      </div>
      <div class="my-flex__item text-center special-diet">
        <p>饮食推荐</p>
        <p>Diet recommendation</p>
      </div>
    </div>
    <div class="my-flex">
      <div class="my-flex__item text-center special-health">
        <p>健康常识</p>
        <p>Health knowledge</p>
      </div>
      <div class="my-flex__item text-center special-expert">
        <p>专家建议</p>
        <p>Expert advice</p>
      </div>
    </div>
  </section>

  <!-- footer -->
  <footer>
    <p>本产品分析结果仅供参考，不应成为诊断或治疗疾病的最终依据。</p>
    <div class="weui-footer">
      <p class="weui-footer__text">Copyright © 10wfans.com </p>
    </div>
  </footer>

  <!-- tabbar -->
  <div id="myTabbar" class="weui-tabbar">
    <a href="javascript:;" class="weui-tabbar__item tab-active">
      <div class="weui-tabbar__icon tab-icon">
      </div>
      <p class="weui-tabbar__label">首页</p>
    </a>
    <a href="javascript:;" class="weui-tabbar__item">
      <div class="weui-tabbar__icon tab-icon tab-icon1">
      </div>
      <p class="weui-tabbar__label">附近的秤</p>
    </a>
    <a href="javascript:;" class="weui-tabbar__item">
      <div class="weui-tabbar__icon tab-icon tab-icon2">
      </div>
      <p class="weui-tabbar__label">我要PK</p>
    </a>
    <a href="javascript:;" class="weui-tabbar__item">
      <div class="weui-tabbar__icon tab-icon tab-icon3">
      </div>
      <p class="weui-tabbar__label">我的</p>
    </a>
  </div>

  <!-- script -->
  <script type="text/javascript" src="../js/jquery.min.js"></script>
  <script type="text/javascript" src="../js/jquery-weui.min.js"></script>
  <script type="text/javascript" src="../js/echarts.min.js"></script>
  <script type="text/javascript" src="../js/swiper.min.js"></script>
  <script type="text/javascript" src="../js/dlc.js"></script>
  <script type="text/javascript" src="../js/tooltipbox.js"></script>
  <script type="text/javascript" src="../js/main.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      // swiper轮播
      $('.swiper-container').swiper({
          loop: true,
          pagination: '.pagination'
      });

      //row动画
      $('#row').addClass('rote90');

      // special-column click
      $('.special-sports').click(function () {
        location.href = 'specialColumnS.html';
      });
      $('.special-diet').click(function () {
        location.href = 'specialColumnD.html';
      });

      // BMI说明框
      $('.person-bmi p:first-child').click(function () {
        $.alert("身体质量指数(BMI)是目前国际上常用的衡量人体胖瘦程度以及是否健康的一个标准", "BMI");
      });

      // *迪尔西 逻辑
      if(getUrlParam('opendid')){
        localStorage.setItem('wx_openid',getUrlParam('opendid'));
        localStorage.setItem('hid',getUrlParam('hid'));
      }else{
        console.log('opendid undefined');
      }

      $.ajax({ //请求体重等数据
        type:"post",
        data:{
          api_name:'getHealth',
          openid:localStorage.getItem('wx_openid'),
          id:localStorage.getItem('hid')
        },
        url: location.origin+'/freeBalance/mock/getHealth.json',
        dataType:'json',
        success: function (data) {
          // console.log(data);
          var res = data.data;
          if(data.code=='1'){ 
            // $('#sex').text(res.sex);
            // $('#age').text(res.age+'岁');
            $('#height').text(res.height);
            $('#weight').text(res.weight * 2);
            $('#bmi').text((res.fat === null ? '--':res.fat)); // fat就是BMI字段
            $('#weightType').text(res.hname === null ? '--': res.hname);  
            $('#standardWeight').text(res.standard_weight === null ? '--':res.standard_weight*2+'斤');
            $('#perfectWeight').text(res.standard_weight === null ? '--':res.standard_weight*2+5+'斤');
            $('#standarBmi').text(res.standard_fat === null?'--':res.standard_fat);// 正常BMI范围
          }
        }
      });

      // 底部tabbar导航事件
      $('#myTabbar a').eq(0).click(function(){
        location.href='index.html?opendid='+localStorage.getItem('wx_openid')+'&hid='+localStorage.getItem('hid');
      });

      $('#myTabbar a').eq(1).click(function(){
        location.href='map.html';
      });

      $('#myTabbar a').eq(2).click(function(){
        location.href='pk.html';
      });

      $('#myTabbar a').eq(3).click(function(){
        location.href='person.html?status=1';
      });

      // 历史体重
      // 历史体重 echarts曲线
      var myChart = echarts.init(document.getElementById('historyWeight'));
      option = {
          title: {
              text: '历史体重',
              textStyle: {
                color: '#3da2d5',
                fontSize: 16,
                fontWeight: '500'
              },
              top: 8,
              left: 8
          },
          toolbox: {
              feature: {
                  saveAsImage: {}
              }
          },
          grid: {
              left: '6%',
              right: '6%',
              top: '45',
              height: 130,
              containLabel: true
          },
          xAxis : {
              boundaryGap: false,
              splitLine: {
                show: true,
                interval: 'auto',
                lineStyle: {
                  color: '#eee'
                }
              },
              axisTick: {
                show: false
              },
              axisLine: {
                lineStyle: {
                  color: '#eee'
                }
              },
              axisLabel: {
                color: '#999'
              },
              data : []
          },
          yAxis : {
              type: 'value',
              min: function(value) {
                    return value.min - 30;
              },
              max: function(value) {
                    return value.max + 30;
              },
              axisTick: {
                show: false
              },
              axisLine: {
                lineStyle: {
                  color: '#eee'
                }
              },
              axisLabel: {
                show: false
              },
              splitLine: {
                lineStyle: {
                  color: '#eee'
                }
              }
          },
          series : {
              name:'体重',
              type:'line',
              smooth: true,
              symbol: 'circle',
              symbolSize: 6,
              label: {
                normal: {
                  show: true,
                  color: '#00ac82'
                }
              },
              areaStyle: {
                normal: {
                  color: "#d4f7ed"
                }
              },
              itemStyle: {
                normal: {
                  color: '#00ac82'
                }
              },
              lineStyle: {
                normal: {
                  width: 2
                }
              },
              data: []
          },
          dataZoom: [
            {
              type: 'slider',
              show: true,
              dataBackground: {
                lineStyle: {
                  color: '#d4f7ed'
                },
                areaStyle: {
                  color: '#28b3ea'
                }
              },
              fillerColor: 'rgba(212,247,237, .5)',
              borderColor: '#fff',
              handleStyle: {
                color: '#00ac82'
              },
              xAxisIndex: [0],
              bottom: 8,
              start: 1, // 数据窗口范围的起始百分比
              end: 80
            }
          ]
      };

      //请求健康列表(最新的前七次秤重数据)
      $.ajax({
        type: "post",
        data:{
          api_name:'healthList',
          page: 1, // 页数
          pagesize: 7, // 每页展示10个
          openid:localStorage.getItem('wx_openid'),
        },
        url: "http://127.0.0.1/freeBalance/mock/healthList.json", 
        dataType: 'json',
        success: function(data){
          console.log(data);
          var weight = [], ctime = [];
          if (data.code === 1) {
            for(var i in data.data.stat){
              weight.push(data.data.stat[i].weight * 2);
              ctime.push(data.data.stat[i].ctime.substr(5));
            }
          } else {
            $.toast("纯文本", data.code);
          }
          option.xAxis.data = ctime;
          option.series.data = weight;
          myChart.setOption(option);
        },
        error: function () {
          myChart.setOption(option);
        }
      });

      //判断健康状况
      // function getTip(){
      //   var Height=Number($('#Height').text())/100;
      //   var weight=Number($('#weight').text());
      //   var indicators=(weight/(Height*Height)).toFixed(2);
      //   console.log(indicators)
      //   var tipText='';
      //   if(indicators<18.5){
      //     tipText='偏瘦：下次多吃点再来吧！';
      //   }else if(indicators>=18.5 && indicators<=23.9 ){
      //     tipText='正常：很棒哦！快去告诉身边的朋友吧！';
      //   }else if(indicators>=28 ){
      //     tipText='肥胖：从现在开始减肥，相信自己会瘦下来！加油！';
      //   }else if(indicators>24 && indicators <=27.9){
      //     tipText='偏胖：少吃那么一丢丢你就是标准体重啦，加油吧！';
      //   }else if(indicators>=24){
      //     tipText='超重：少吃多运动很健康哦！';
      //   }
      //   $('#tipText').text(tipText);
      //   return indicators;
      // }
    });
  </script>
</body>
</html>